<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="img/icon.png" type="image/x-icon" />
    <title>MuniEvents</title>
    <!-- INICIO DEL CSS -->
    <link rel="stylesheet" href="./estilos/iniciologeado.css" />
    <!-- FIN DEL CSS -->
    <!-- INICIO DE ENLACES BOOSTRAP -->
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-..."
      crossorigin="anonymous"
    />
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- FIN DE ENLACES BOOSTRAP -->
  </head>
  <body>
    <!-- INICIO HEADER -->
    <header class="header-image">
      <img src="img/logo.png" alt="Header Image" class="img-fluid" />
    </header>
    <!--FIN DEL HEADER-->

    <!-- INICIO DE LA BARRA DE NAVEGACION LOGEADO -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="iniciologeado.html">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="noticia.html">Noticias</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="suscripcionTrimestral.html"
                >Suscripción</a
              >
            </li>
          </ul>
          <form
            class="form-inline my-2 my-lg-0"
            action="buscador.html"
            method="GET"
          >
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">
              Buscar
            </button>
          </form>
          <div class="dropdown ml-2">
            <button
              class="btn btn-secondary dropdown-toggle"
              type="button"
              id="dropdownMenuButton"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <img
                src="https://bootdey.com/img/Content/avatar/avatar7.png"
                alt="Imagen de Perfil"
                class="rounded-circle"
                style="width: 30px; height: 30px"
              />
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="perfil.html">Perfil</a>
              <a class="dropdown-item" href="#">Configuración</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="index.html"
                >Cerrar Sesión</a
              >
            </div>
          </div>
          <img
            src="./img/moneda.webp"
            alt="Descripción de la imagen"
            style="max-width: 30px; max-height: auto"
          />
          <p>200</p>
        </div>
      </div>
    </nav>
    <!-- FIN DE LA BARRA DE NAVEGACION LOGEADO -->
    <!--EVENTOS(8)/NOTICIAS(4)-->
    <div class="container mt-4">
      <div class="row" id="eventos-container">
        <!--INICIO DE LA COLUMNA SECCION DE EVENTOS-->
        <div class="col-md-8">
          <div class="row" id="eventos-contenido"></div>
          <!-- FIN DE LA COLUMNA SECCION DE EVENTOS-->
          <!-- INICIO PAGINACION -->
          <div class="mx-auto d-flex justify-content-center">
            <nav aria-label="Page navigation">
              <ul class="pagination text-center">
                <li class="page-item disabled">
                  <a class="page-link" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">4</a></li>
                <li class="page-item"><a class="page-link" href="#">5</a></li>
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- FIN DE LA PAGINACION -->
        <!-- FIN DE LA COLUMNA SECCION DE EVENTOS -->

        <!--INICIO DE LA COLUMNA SECCION NOTICIAS RECIENTES -->
        <div class="col-md-4" id="noticias-container">
          <aside class="bg-light">
            <div class="container pt-4 pb-4">
              <h4>Noticias Recientes</h4>
              <!-- Contenedor dinámico para las noticias recientes -->
              <div id="noticias-contenido" class="row"></div>
            </div>
          </aside>
        </div>
        <!--FIN DE LA COLUMNA SECCION NOTICIAS RECIENTES -->
      </div>
    </div>

    <!--INICIO DEL FOOTER DE LA PAGINA-->
    <footer class="bg-dark footer">
      <div class="footer-top py-8">
        <div class="container">
          <div class="row gy-5">
            <div class="col-lg-8 pe-xxl-10">
              <div class="row gy-5">
                <div class="col-6 col-lg-4">
                  <h5 class="text-white footer-title-01">MuniEvents</h5>
                  <ul class="list-unstyled footer-link-01 m-0">
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Sobre nosotros</a
                      >
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#">Blog</a>
                    </li>
                  </ul>
                </div>
                <div class="col-6 col-lg-4">
                  <h5 class="text-white footer-title-01">Acerca de</h5>
                  <ul class="list-unstyled footer-link-01 m-0">
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Servicio al Cliente</a
                      >
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Política de privacidad</a
                      >
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Política de cookies</a
                      >
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Terminos y condiciones</a
                      >
                    </li>
                    <li><a class="text-white text-opacity-75" href="#"></a></li>
                  </ul>
                </div>
                <div class="col-6 col-lg-4">
                  <h5 class="text-white footer-title-01">Necesitas Ayuda?</h5>
                  <ul class="list-unstyled footer-link-01 m-0">
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Contacta con nosotros</a
                      >
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Preguntas frecuentes</a
                      >
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#">Ofertas</a>
                    </li>
                    <li>
                      <a class="text-white text-opacity-75" href="#"
                        >Nuestros eventos</a
                      >
                    </li>
                    <li>
                      <img
                        src="img/generalitat.img.png"
                        alt="Descripción de la imagen"
                        style="max-width: 100px; max-height: auto"
                      />
                    </li>
                    <li>
                      <img
                        src="img/ajuntament.cornellaimg.jpg"
                        alt="Descripción de la imagen"
                        style="max-width: 100px; max-height: auto"
                      />
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <h5 class="text-white footer-title-01 fs-5">
                Suscríbete a nuestra newsletter y obtén un 15% de descuento en
                tu próximo compra.
              </h5>
              <div>
                <form class="d-flex flex-row mb-2 p-1 bg-white input-group">
                  <input
                    type="email"
                    class="form-control rounded border-0"
                    placeholder="Tu email"
                  />
                  <button class="btn btn-secondary flex-shrink-0" type="submit">
                    Suscribete
                  </button>
                </form>
              </div>
              <div class="social-icons text-center">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="footer-bottom small py-3 border-top border-white border-opacity-10"
      >
        <div class="container">
          <div class="row">
            <div class="col-md-6 text-center text-md-start py-1">
              <p class="m-0 text-white text-opacity-75">
                © 2024 copyright<a class="text-reset" href="#"
                  >MuniEvents.com</a
                >
              </p>
            </div>
            <div class="col-md-6 text-center text-md-end py-1">
              <ul
                class="nav justify-content-center justify-content-md-end list-unstyled footer-link-01 m-0"
              >
                <li class="p-0 mx-3 ms-md-0 me-md-3">
                  <a href="#" class="text-white text-opacity-75"
                    >Privacidad &amp; Politicas</a
                  >
                </li>
                <li class="p-0 mx-3 ms-md-0 me-md-3">
                  <a href="#" class="text-white text-opacity-75"
                    >Preguntas y respuestas</a
                  >
                </li>
                <li class="p-0 mx-3 ms-md-0 me-md-3">
                  <a href="#" class="text-white text-opacity-75">Entrevistas</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!--FIN DEL FOOTER DE LA PAGINA-->
    <!--INICIO DE ENLACES A BOOSTRAP A JS Y JQUERY(NECESARIOS PARA ALGUNOS COMPONENTES) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!--FIN DE ENLACES A BOOSTRAP A JS Y JQUERY(NECESARIOS PARA ALGUNOS COMPONENTES) -->

    <script>

      // ENLACE DEL JSON PARA EVENTOS EN LA PÁGINA DE INICIO
      const jsonEnlace = "https://ic2o8act3c.execute-api.us-east-1.amazonaws.com/pagina-de-inicio-eventos/pagina-de-inicio-eventos";

      // FUNCION ASINCRONA PARA CARGAR EVENTOS EN LA PÁGINA DE INICIO
      async function cargarEventos() {
          // OBTENER RESPUESTA DEL FETCH AL JSON DE EVENTOS
          const respuesta = await fetch(jsonEnlace);
          // PARSEAR LA RESPUESTA A FORMATO JSON
          const eventos = await respuesta.json();
          // OBTENER CONTENEDOR DE EVENTOS EN EL DOM
          const eventosContainer = document.getElementById("eventos-contenido");

          // ITERAR A TRAVÉS DE CADA EVENTO Y GENERAR HTML DINÁMICO
          eventos.forEach((evento, index) => {
              // VALORACIÓN SERÁ UN ARRAY CON LAS VALORACIONES (TEMPORAL PARA PRUEBAS)
              const valoracion = [4.5, 3.9, 4.6, 3.7, 4.5][index];

              // GENERAR HTML PARA LAS ESTRELLAS DE VALORACIÓN
              const estrellasHTML = Array.from({ length: 5 }, (_, i) => {
                  const faClass = i + 1 <= valoracion ? 'fa-star' : 'fa-star-o';
                  return `<i class="fa ${faClass}" style="color: #FFD43B;"></i>`;
              }).join('');

              // CONCATENAR VALORACIÓN Y ESTRELLAS AL HTML DEL EVENTO
              const valoracionHTML = `${valoracion.toFixed(1)} ${estrellasHTML}`;

              const eventoHTML = `
                  <div class="col-md-12 mb-4">
                      <div class="card">
                          <div class="row no-gutters">
                              <div class="col-md-4">
                                  <img src="${evento.imagen}" class="card-img img-fluid" alt="${evento.titulo_imagen}" style="height: 250px; object-fit: cover;">
                              </div>
                              <div class="col-md-8">
                                  <div class="card-body">
                                      <h5 class="card-title">${evento.titulo_imagen}</h5>
                                      <p class="card-text">${evento.descripcion_breve}</p>
                                      <div class="valoracion">${valoracionHTML}</div>
                                      <a href="eventoLogeado${index + 1}.html" class="btn btn-primary">Ver más</a>
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              `;

              // AGREGAR HTML DEL EVENTO AL CONTENEDOR DE EVENTOS
              eventosContainer.innerHTML += eventoHTML;
          });
      }

      // LLAMAR A LA FUNCIÓN PARA CARGAR EVENTOS CUANDO SE CARGA LA PÁGINA
      cargarEventos();

      // EVENTO AL CARGAR EL DOM
      document.addEventListener("DOMContentLoaded", function () {
          // OBTENER CONTENEDOR DE EVENTOS Y NOTICIAS EN EL DOM
          const eventosContenedor = document.getElementById("eventos-contenido");
          const noticiasContenedor = document.getElementById("noticias-contenido");

          // URL PARA OBTENER JSON DE EVENTOS Y NOTICIAS
          const urlEventosJson = "https://k8lkfryeq4.execute-api.us-east-1.amazonaws.com/eventos/eventos";
          const urlNoticiasJson = "https://k8lkfryeq4.execute-api.us-east-1.amazonaws.com/noticias-recientes/noticias-recientes";

          // FUNCION PARA MOSTRAR EVENTOS
          function mostrarEventos() {
              // FETCH AL JSON DE EVENTOS
              fetch(urlEventosJson)
                  .then(response => response.json())
                  .then(data => {
                      // ITERAR A TRAVÉS DE LOS EVENTOS Y GENERAR BOTONES "VER MÁS"
                      data.forEach(evento => {
                          const eventoHTML = `
                              <div class="card mb-3">
                                  <button class="btn btn-primary ver-mas-btn" data-evento-id="${evento.id}">Ver Más</button>
                              </div>
                          `;

                          // AGREGAR HTML DEL EVENTO AL CONTENEDOR DE EVENTOS
                          eventosContenedor.innerHTML += eventoHTML;
                      });

                      // AGREGAR EVENTLISTENER A CADA BOTÓN "VER MÁS"
                      const verMasButtons = document.querySelectorAll('.ver-mas-btn');
                      verMasButtons.forEach(button => {
                          button.addEventListener('click', () => {
                              // OBTENER ID DEL EVENTO Y REDIRIGIR A LA PÁGINA CORRESPONDIENTE
                              const eventoId = button.getAttribute('data-evento-id');
                              window.location.href = `theproducers.html?evento=${eventoId}`;
                          });
                      });
                  })
                  .catch(error => console.error("Error al obtener eventos:", error));
          }

          // FUNCION PARA MOSTRAR NOTICIAS
          function mostrarNoticias() {
              // FETCH AL JSON DE NOTICIAS
              fetch(urlNoticiasJson)
                  .then(response => response.json())
                  .then(data => {
                      // OBTENER LAS DOS PRIMERAS NOTICIAS
                      const dosNoticias = data.slice(0, 2);

                      // ITERAR A TRAVÉS DE LAS NOTICIAS Y GENERAR HTML
                      dosNoticias.forEach(noticia => {
                          const noticiaHTML = `
                              <div class="card mb-3">
                                  <img src="${noticia.imagen || 'ruta_por_defecto_si_no_hay_imagen'}" class="card-img-top" alt="Imagen de la Noticia">
                                  <div class="card-body">
                                      <h5 class="card-title">${noticia.titulo_imagen || 'Título no disponible'}</h5>
                                      <p class="card-text">${noticia.descripcion_breve || 'Descripción no disponible'}</p>
                                      <p>${noticia.fecha || noticia.tiempo || 'Fecha no disponible'}</p>
                                  </div>
                              </div>
                          `;

                          // AGREGAR HTML DE LA NOTICIA AL CONTENEDOR DE NOTICIAS
                          noticiasContenedor.innerHTML += noticiaHTML;
                      });
                  })
                  .catch(error => console.error("Error al obtener noticias:", error));
          }

          // LLAMAR A LAS FUNCIONES PARA MOSTRAR EVENTOS Y NOTICIAS AL CARGAR EL DOM
          mostrarEventos();
          mostrarNoticias();
      });


    </script>
  </body>
</html>
